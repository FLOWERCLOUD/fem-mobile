<!doctype html>

<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport" content="initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>Mobile FEM Example</title>


<script type="text/javascript" src="FemMobile/FemMobile.nocache.js"></script>
<script type="text/javascript" src="rendermodel.js"></script>
<!-- Include meta tag to ensure proper rendering and touch zooming -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Include jQuery Mobile stylesheets -->
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
<!-- Include the jQuery library -->
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<!-- Include the jQuery Mobile library -->
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

<style>
.main {
	margin: 0px;
	background-color: #000;
	overflow: hidden;
}

.svg {
	margin: 0 auto;
	width: 100%;
	heigth: 80%;
	position: absolute;
	padding-bottom: 80%;
	overflow: visible;
	text-anchor: end;
	z-index: 0;
}

.svg polygon {
	stroke: #0F0F0F;
	stroke-width: 0.4;
	stroke-linejoin: round;
}

.ui-btn {
    width: 120px !important;
}

</style>

</head>

<body class='main'>

	<div data-role="page" id="pagetwo">

		<div data-role="header" data-theme="a" >
		<!-- 	<p>&nbsp;FEM Mobile - by Markus Sprunck</p> -->
			<div data-role="navbar">
				<div data-role="controlgroup" data-type="horizontal">
					<a href="#infoPanel" class="ui-btn ui-icon-info ui-btn-icon-left ui-shadow">Information</a>
					<!--  -->
					<a href="#settingPanel" class="ui-btn ui-icon-gear ui-btn-icon-left ui-shadow">Settings</a>
				</div>
			</div>
		</div>

		<div data-role="main" class="ui-content" >
			<div class="ui-grid-a" >
				<div class="ui-block-b" id="legendBlock" style="width: 0%"
					style="padding-left: 10%; float: left; width: 100%">
					<svg xmlns="http://www.w3.org/2000/svg" class="svg" id="mySVGGuiLegend">		 
				     <g id="svgLegend" />
  		 			</svg>
				</div>
				<div class="ui-block-b" id="graficBlock" viewBox="0 0 100 150" >
					<svg xmlns="http://www.w3.org/2000/svg" class="svg" id="mySVGGui">		 
					 <g id="svgElements" />
					 <g id="svgNodes" />
		 			 <g id="svgFixed" />
  					 <g id="svgArrows" />
  					 <g id="svgForce" />  	 	 
				</svg>
				</div>
			</div>

			<div data-role="panel" class="ui-content" data-display="overlay" id="infoPanel" 
				class="ui-panel ui-panel-position-right ui-panel-display-overlay ui-body-a ui-panel-animate ui-panel-open"
				data-position="right">
				<h4>This application demonstrates the implementation of a minimal Finite Element Method
					Simulation running in a web browser and uses device orientation signals.</h4>
			</div>

			<div data-role="panel" class="ui-content" data-display="overlay" id="settingPanel" 
				class="ui-panel ui-panel-position-right ui-panel-display-overlay ui-body-a ui-panel-animate ui-panel-open"
				data-position="right">
				<form>
					<select name="select-native-s" id="select-color-code" data-mini="true"  data-native-menu="false">
						<option value="4" selected="true">Delta X</option>
						<option value="5">Delta Y</option>
						<option value="1">Stress X</option>
						<option value="2">Stress Y</option>
						<option value="3">Shear Stress</option>
					</select> <select name="select-native-s" id="select-model" data-mini="true"  data-native-menu="false">
						<option value="Beam">Beam</option>
						<option value="Cantilever">Cantilever</option>
						<option value="Eiffel Tower">Eiffel Tower</option>
					</select> 
					<fieldset data-role="controlgroup">
						<label for="gravity" data-mini="true">Simulate Gravity</label> <input type="checkbox"
							name="favcolor" id="gravity" value="gravity" checked="true" data-mini="true">
					</fieldset>
					<fieldset data-role="controlgroup" data-mini="true">
						<label for="showLegend" data-mini="true">Show Legend</label> <input type="checkbox"
							name="favcolor" id="showLegend" value="showLegend" data-mini="true">
					</fieldset>
				</form>
			</div>
		</div>
	</div>

	<noscript>
		<div
			style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
			Your web browser must have JavaScript enabled in order for this application to display correctly.</div>
	</noscript>

	<script type="text/javascript">
		/**
		 * Global variables 
		 */
		var modelRenderer;

		/**
		 * Called by a timer defined in class Fem_sample.java 
		 */
		function setModel() {
			if (typeof modelRenderer !== "undefined") {
				modelRenderer.calculateColorRange();
				modelRenderer.renderModel();
				modelRenderer.renderColorScala();
			} else {
				modelRenderer = new ModelRenderer();
			}
		}

		/**
		 * The window.orientation is different for iOS and Android
		 */
		var checkOrientation = function(eventData) {
			var previousOrientation = window.orientation;
			if (typeof previousOrientation !== "undefined") {
				var ua = navigator.userAgent.toLowerCase();
				var isAndroid = ua.indexOf("android") > -1;
				if (isAndroid) {
					if (!previousOrientation || previousOrientation === 90) {
						OPTIONS.ORIENTATION = 'Normal portrait';
					} else if (previousOrientation === 0) {
						OPTIONS.ORIENTATION = 'Landscape, rotated clockwise';
					} else if (previousOrientation === 180) {
						OPTIONS.ORIENTATION = 'Landscape, rotated counterclockwise';
					} else if (previousOrientation === -90) {
						OPTIONS.ORIENTATION = 'Portrait, upside down';
					}
				} else {
					if (!previousOrientation || previousOrientation === 0) {
						OPTIONS.ORIENTATION = 'Normal portrait';
					} else if (previousOrientation === -90) {
						OPTIONS.ORIENTATION = 'Landscape, rotated clockwise';
					} else if (previousOrientation === 90) {
						OPTIONS.ORIENTATION = 'Landscape, rotated counterclockwise';
					} else if (previousOrientation === 180) {
						OPTIONS.ORIENTATION = 'Portrait, upside down';
					}
				}
			}
		};

		/**
		 * Android doesn't always fire orientationChange on 180 degree turns
		 */
		setInterval(checkOrientation, 1000);

		function resizeElements() {
			checkOrientation(null);
		};
		window.onresize = resizeElements;

		var deviceorientation = function(eventData) {
			if (typeof modelRenderer !== "undefined") {
				var beta;
				var gamma;
				if (OPTIONS.ORIENTATION == 'Normal portrait') {
					beta = -eventData.beta;
					gamma = -eventData.gamma;
				} else if (OPTIONS.ORIENTATION == 'Landscape, rotated clockwise') {
					beta = -eventData.gamma;
					gamma = eventData.beta;
				} else if (OPTIONS.ORIENTATION == 'Landscape, rotated counterclockwise') {
					beta = eventData.gamma;
					gamma = -eventData.beta;
				} else if (OPTIONS.ORIENTATION == 'Portrait, upside down') {
					beta = eventData.beta;
					gamma = eventData.gamma;
				}

				if (modelRenderer.rotate) {
					temp = gamma;
					gamma = beta;
					beta = -temp;
				}

				if (typeof modelRenderer !== "undefined" && OPTIONS.GRAVITY_ACTIVE) {
					OPTIONS.BETA = beta;
					OPTIONS.GAMMA = gamma;
					fem_runSimulation();
				}
			}
		}
		window.addEventListener('deviceorientation', deviceorientation, false);
		window.addEventListener("resize", checkOrientation, false);
		window.addEventListener("orientationchange", checkOrientation, false);

		function isGravityActive() {
			return '' + OPTIONS.GRAVITY_ACTIVE;
		}

		function getSelecedNodeId() {
			return '' + modelRenderer.selecedNodeId;
		}

		function getBeta() {
			return '' + OPTIONS.BETA;
		}

		function getGamma() {
			return '' + OPTIONS.GAMMA;
		}

		function getForceX() {
			return '' + modelRenderer.forceX;
		}

		function getForceY() {
			return '' + modelRenderer.forceY;
		}

		function getModelName() {
			return '' + OPTIONS.MODEL_NAME;
		}

		$('#gravity').click(function() {
			OPTIONS.GRAVITY_ACTIVE = this.checked;
			if (OPTIONS.GRAVITY_ACTIVE) {
				OPTIONS.BETA = -25.0;
				OPTIONS.GAMMA = 0.0;
			} else {
				OPTIONS.BETA = 0.0;
				OPTIONS.GAMMA = 0.0;
			}
			fem_runSimulation();
		});

		$('#select-model').change(function() {
			$("#select-model option:selected").each(function() {
				OPTIONS.MODEL_NAME = $(this).text();
				modelChangeHandler();
				fem_runSimulation();
			});
		});

		$('#select-color-code').change(function() {
			$("#select-color-code option:selected").each(function() {
				OPTIONS.COLOR_CODE = this.value;
				fem_runSimulation();
			});
		});

		$('#showLegend').click(function() {
			OPTIONS.SHOW_LEGEND = this.checked;
			$('#legendBlock').width(OPTIONS.SHOW_LEGEND ? "15%" : "0%");
			$('#graficBlock').width(OPTIONS.SHOW_LEGEND ? "85%" : "100%");
			fem_runSimulation();
		});

		var modelChangeHandler = function(value) {

			if (OPTIONS.MODEL_NAME == 'Beam') {
				OPTIONS.LEFT = 50;
				OPTIONS.BOTTOM = 160;
				OPTIONS.SCALE_DISPLACEMENT = 4;
				OPTIONS.SCALE_FORCE = 0.0008;
				OPTIONS.COLOR_CODE = 1;
			} else if (OPTIONS.MODEL_NAME == 'Cantilever') {
				OPTIONS.LEFT = 50;
				OPTIONS.BOTTOM = 160;
				OPTIONS.SCALE_DISPLACEMENT = 0.5;
				OPTIONS.SCALE_FORCE = 0.0001;
				OPTIONS.COLOR_CODE = 1;
			} else {
				OPTIONS.LEFT = 42;
				OPTIONS.BOTTOM = 470;
				OPTIONS.SCALE_DISPLACEMENT = 0.5;
				OPTIONS.SCALE_FORCE = 0.001;
				OPTIONS.COLOR_CODE = 2;
			}

			var myNode = document.getElementById('svgElements');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			var myNode = document.getElementById('svgNodes');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			var myNode = document.getElementById('svgFixed');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			var myNode = document.getElementById('svgArrows');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			var myNode = document.getElementById('svgLegend');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			fem_runSimulation();
		}
	</script>
</body>
</html>
