<!doctype html>

<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport" content="initial-scale=1">
<title>Mobile FEM Example</title>


<script type="text/javascript" src="FemMobile/FemMobile.nocache.js"></script>
<script type="text/javascript" src="rendermodel.js"></script>

<!-- Include meta tag to ensure proper rendering and touch zooming -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Include jQuery Mobile stylesheets -->
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">

<!-- Include the jQuery library -->
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Include the jQuery Mobile library -->
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

<style>
div.ui-content {
	padding-top: 5px !important;
	padding-left: 10px !important;
}

.svg {
	top: 80px !important;
	margin: 0 auto;
	width: 90%;
	position: absolute;
	overflow: visible;
	text-anchor: end;
	z-index: 0;
	background-color: #2a2a2a;
}

.svg polygon {
	stroke: #0F0F0F;
	stroke-width: 0.4;
	stroke-linejoin: round;
}

.ui-btn {
	width: 120px !important;
}

.ui-mini {
	margin: .0em;
}

label {
	font-size: 14px !important;
}
</style>

</head>

<body class='main'>

	<div class="ui-body-b" data-role="page">

		<div data-role="header">
			<a href="#popupLogin" data-rel="popup" data-position-to="window"
				class="ui-btn ui-icon-edit ui-btn-icon-notext ui-corner-all" data-transition="pop">Edit</a>
			<!-- a/#popupLogin -->
			<a href="#infoPanel" class="ui-btn ui-icon-info ui-btn-icon-notext ui-corner-all"
				data-transition="pop">About</a>
			<!-- a/#infoPanel -->
		</div>
		<!-- div/header -->

		<div data-role="main" class="ui-content">

			<div class="ui-grid-b">
				<div class="ui-block-b" id="legendBlock" style="width: 0%">
					<svg xmlns="http://www.w3.org/2000/svg" class="svg" id="mySVGGuiLegend">		 
				     <g id="svgLegend" />
  		 			</svg>
				</div>
				<div class="ui-block-b" id="graficBlock" viewBox="0 0 10 10">
					<svg xmlns="http://www.w3.org/2000/svg" class="svg" id="mySVGGui">		 
					 <g id="svgElements" />
					 <g id="svgNodes" />
		 			 <g id="svgFixed" />
  					 <g id="svgArrows" />
  					 <g id="svgForce" />  	 	 
				</svg>
				</div>
			</div>
			<!-- /ui-grid-b -->

			<div data-role="panel" class="ui-content" data-display="overlay" id="infoPanel"
				class="ui-panel ui-panel-position-right ui-panel-display-overlay ui-body-b ui-panel-animate ui-panel-open"
				data-position="right" data-theme="b">
				<div style="padding: 0px 5px;">
					<h3>Mobile FEM Example</h3>
					This application demonstrates the implementation of a minimal Finite Element Method Simulation
					running in a web browser and uses device orientation signals.
					<p>
						You may read more <a
							href="http://www.sw-engineering-candies.com/blog-1/finite-element-method-simulation-running-in-the-browser-and-uses-device-orientation">here</a>
					</p>
				</div>
			</div>
			<!-- /ui-content -->

			<div data-role="popup" id="popupLogin" id="popupDialog" class="ui-corner-all"
				data-overlay-theme="a" data-theme="b" data-dismissible="true" style="max-width: 600px;">
				<h3 class="ui-bar ui-bar-a ui-corner-all">Edit Options</h3>
				<form>
					<div style="padding: 10px 20px;">
						<fieldset class="ui-grid-a">
							<div class="ui-block-a" style="margin-bottom: 25px;">
								<label for="select-color-code">Color Code:</label>
								<!-- combobox -->
								<select name="select-native-s" id="select-color-code" data-native-menu="true"
									data-mini="true">
									<option value="4" selected="true">Delta X</option>
									<option value="5">Delta Y</option>
									<option value="1">Stress X</option>
									<option value="2">Stress Y</option>
									<option value="3">Shear Stress</option>   
								</select>
							</div>
							<!-- <div class="ui-block-a"> -->
							<div class="ui-block-b" style="margin-bottom: 25px;">
								<label for="select-model">Model:</label>
								<!-- combobox -->
								<select name="select-native-s" id="select-model" data-native-menu="true" data-mini="true">
									<option value="Beam">Beam</option>
									<option value="Cantilever">Cantilever</option>
									<option value="Eiffel Tower">Eiffel Tower</option>
								</select>
							</div>
							<!-- <div class="ui-block-b"> -->

							<div class="ui-block-a">
								<label for="gravity-fieldset">Forces:</label>
								<fieldset data-role="controlgroup" id="gravity-fieldset">
									<label for="gravity">Gravity</label> <input type="checkbox" name="favcolor" id="gravity"
										value="gravity" data-mini="true">
								</fieldset>
							</div>
							<!-- ui-block"> -->
							<div class="ui-block-b">
								<label for="showLegend-fieldset">Display Options:</label>
								<fieldset data-role="controlgroup" id="showLegend-fieldset">
									<label for="showLegend">Show Legend</label> <input type="checkbox" name="favcolor"
										id="showLegend" value="showLegend" data-mini="true">
								</fieldset>
							</div>
							<!-- ui-block"> -->
						</fieldset>
						<!-- /ui-grid-b-->
					</div>
					<!-- <div style="padding:10px 20px;"> -->
				</form>
			</div>
		</div>
	</div>
	<!-- /ui-body-b -->

	<noscript>
		<div
			style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
			Your web browser must have JavaScript enabled in order for this application to display correctly.</div>
	</noscript>

	<script type="text/javascript">
		/**
		 * Global variables 
		 */
		var modelRenderer;

		/**
		 * Called by a timer defined in class Fem_sample.java 
		 */
		function setModel() {
			if (typeof modelRenderer !== "undefined") {
				modelRenderer.calculateColorRange();
				modelRenderer.renderModel();
				modelRenderer.renderColorScala();

				$('#gravity').prop('checked', OPTIONS.GRAVITY_ACTIVE).checkboxradio("refresh");
				;
			} else {
				modelRenderer = new ModelRenderer();
			}
		}

		/**
		 * The window.orientation is different for iOS and Android
		 */
		var checkOrientation = function(eventData) {
			var previousOrientation = window.orientation;
			if (typeof previousOrientation !== "undefined") {
				var ua = navigator.userAgent.toLowerCase();
				var isAndroid = ua.indexOf("android") > -1;
				if (isAndroid) {
					if (!previousOrientation || previousOrientation === 90) {
						OPTIONS.ORIENTATION = 'Normal portrait';
					} else if (previousOrientation === 0) {
						OPTIONS.ORIENTATION = 'Landscape, rotated clockwise';
					} else if (previousOrientation === 180) {
						OPTIONS.ORIENTATION = 'Landscape, rotated counterclockwise';
					} else if (previousOrientation === -90) {
						OPTIONS.ORIENTATION = 'Portrait, upside down';
					}
				} else {
					if (!previousOrientation || previousOrientation === 0) {
						OPTIONS.ORIENTATION = 'Normal portrait';
					} else if (previousOrientation === -90) {
						OPTIONS.ORIENTATION = 'Landscape, rotated clockwise';
					} else if (previousOrientation === 90) {
						OPTIONS.ORIENTATION = 'Landscape, rotated counterclockwise';
					} else if (previousOrientation === 180) {
						OPTIONS.ORIENTATION = 'Portrait, upside down';
					}
				}
			}
		};

		/**
		 * Android doesn't always fire orientationChange on 180 degree turns
		 */
		setInterval(checkOrientation, 1000);

		function resizeElements() {
			checkOrientation(null);
		};
		window.onresize = resizeElements;

		var deviceorientation = function(eventData) {
			if (typeof modelRenderer !== "undefined") {
				var beta;
				var gamma;
				if (OPTIONS.ORIENTATION == 'Normal portrait') {
					beta = -eventData.beta;
					gamma = -eventData.gamma;
				} else if (OPTIONS.ORIENTATION == 'Landscape, rotated clockwise') {
					beta = -eventData.gamma;
					gamma = eventData.beta;
				} else if (OPTIONS.ORIENTATION == 'Landscape, rotated counterclockwise') {
					beta = eventData.gamma;
					gamma = -eventData.beta;
				} else if (OPTIONS.ORIENTATION == 'Portrait, upside down') {
					beta = eventData.beta;
					gamma = eventData.gamma;
				}

				if (modelRenderer.rotate) {
					temp = gamma;
					gamma = beta;
					beta = -temp;
				}

				if (typeof modelRenderer !== "undefined" && OPTIONS.GRAVITY_ACTIVE) {
					OPTIONS.BETA = beta;
					OPTIONS.GAMMA = gamma;
					fem_runSimulation();
				}
			}
		}
		window.addEventListener('deviceorientation', deviceorientation, false);
		window.addEventListener("resize", checkOrientation, false);
		window.addEventListener("orientationchange", checkOrientation, false);

		function isGravityActive() {
			return '' + OPTIONS.GRAVITY_ACTIVE;
		}

		function getSelecedNodeId() {
			return '' + modelRenderer.selecedNodeId;
		}

		function getBeta() {
			return '' + OPTIONS.BETA;
		}

		function getGamma() {
			return '' + OPTIONS.GAMMA;
		}

		function getForceX() {
			return '' + modelRenderer.forceX;
		}

		function getForceY() {
			return '' + modelRenderer.forceY;
		}

		function getModelName() {
			return '' + OPTIONS.MODEL_NAME;
		}

		$('#gravity').click(function() {
			OPTIONS.GRAVITY_ACTIVE = this.checked;
			if (OPTIONS.GRAVITY_ACTIVE) {
				OPTIONS.BETA = -25.0;
				OPTIONS.GAMMA = 0.0;
			} else {
				OPTIONS.BETA = 0.0;
				OPTIONS.GAMMA = 0.0;
			}
			fem_runSimulation();
		});

		$('#select-model').change(function() {
			$("#select-model option:selected").each(function() {
				OPTIONS.MODEL_NAME = $(this).text();
				modelChangeHandler();
				fem_runSimulation();
			});
		});

		$('#select-color-code').change(function() {
			$("#select-color-code option:selected").each(function() {
				OPTIONS.COLOR_CODE = this.value;
				fem_runSimulation();
			});
		});

		$('#showLegend').click(function() {
			OPTIONS.SHOW_LEGEND = this.checked;
			$('#legendBlock').width(OPTIONS.SHOW_LEGEND ? "15%" : "0%");
			$('#graficBlock').width(OPTIONS.SHOW_LEGEND ? "85%" : "100%");
			fem_runSimulation();
		});

		var modelChangeHandler = function(value) {

			if (OPTIONS.MODEL_NAME == 'Beam') {
				OPTIONS.LEFT = 50;
				OPTIONS.BOTTOM = 160;
				OPTIONS.SCALE_DISPLACEMENT = 4;
				OPTIONS.SCALE_FORCE = 0.0008;
				OPTIONS.COLOR_CODE = 1;
			} else if (OPTIONS.MODEL_NAME == 'Cantilever') {
				OPTIONS.LEFT = 50;
				OPTIONS.BOTTOM = 160;
				OPTIONS.SCALE_DISPLACEMENT = 0.5;
				OPTIONS.SCALE_FORCE = 0.0001;
				OPTIONS.COLOR_CODE = 1;
			} else {
				OPTIONS.LEFT = 42;
				OPTIONS.BOTTOM = 470;
				OPTIONS.SCALE_DISPLACEMENT = 0.5;
				OPTIONS.SCALE_FORCE = 0.001;
				OPTIONS.COLOR_CODE = 2;
			}

			var myNode = document.getElementById('svgElements');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			var myNode = document.getElementById('svgNodes');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			var myNode = document.getElementById('svgFixed');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			var myNode = document.getElementById('svgArrows');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			var myNode = document.getElementById('svgLegend');
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}

			fem_runSimulation();
		}
	</script>
</body>
</html>
